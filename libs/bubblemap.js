!function(t){function e(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(2);var a=i(1),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o={version:"1.0.14",build:1505429416314},n=Vizabi.Tool.extend("BubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:s.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:1}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,scale:.95,offset:{top:0,right:0,bottom:0,left:0},projection:"robinson",topology:{path:null,objects:{geo:"land",boundaries:"countries"},geoIdProperty:null}},chart:{superhighlightOnMinimapHover:!0,labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","size","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","moreoptions"],sidebar:["colors","find","size"],moreoptions:["opacity","speed","size","colors","presentation","about"]},presentation:!1}},versionInfo:o});e.default=n},function(t,e,i){"use strict";function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var s=Vizabi,o=(s._globals,s.utils),n=s.Component,l=s.helpers,r=l.labels,h=l.topojson,d=l["d3.geoProjection"],c=l["d3.dynamicBackground"],m=s.iconset,u=m.warn,p=m.question,g=n.extend("bubblemap",{init:function(t,e){var a=this;this.name="bubblemap",this.template=i(3),this.bubblesDrawing=null,this.isMobile=o.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"},{name:"data",type:"data"}];var s=this;this.model_binds={"change:time.value":function(t){s._readyOnce&&s.model.marker.getFrame(s.model.time.value,s.frameChanged.bind(s))},"change:marker.highlight":function(t){s._readyOnce&&(s.highlightMarkers(),s.updateOpacity())},"change:marker":function(t,e){s._readyOnce&&e.indexOf("scaleType")>-1&&s.ready()},"change:marker.size.extent":function(t,e){s._readyOnce&&s.entityBubbles&&(s.updateMarkerSizeLimits(),s.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){s._readyOnce&&s.redrawDataPoints(null,!1)},"change:marker.select":function(t){s._readyOnce&&(s.selectMarkers(),s.redrawDataPoints(null,!1),s.updateOpacity(),s.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){s.updateOpacity()},"change:marker.opacityRegular":function(t){s.updateOpacity()},"change:marker.superHighlight":function(){return a._readyOnce&&a._blinkSuperHighlighted()}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),s.COLOR_WHITEISH="#fdfdfd",d(),this._labels=new r(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-bmc-tooltip"),this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new c(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var t=this;this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),t.redrawDataPoints())}),this.initMap(),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var t=this;this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){if(i.toString()!=t.model.time.value.toString())return void o.defer(function(){t.ready()});e&&(t.values=e,t.updateEntities(),t.updateTime(),t._labels.ready(),t.redrawDataPoints(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity())})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),o.setIcon(this.dataWarningEl,u).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),a=t.root.element.getBoundingClientRect(),s=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+s.left-a.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),a=t.root.element.getBoundingClientRect(),s=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+s.left-a.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=this,e=void 0;if(t.isMobile&&t.model.marker.select&&1===t.model.marker.select.length&&(e=t.model.marker.select[0]),t.hovered||e){var i=t.model.marker.size.getConceptprops(),a=t.model.marker.color.getConceptprops(),s=t.hovered||e,o=t.model.marker.size.getTickFormatter(),n=t.model.marker.color.getTickFormatter(),l=i.unit||"",r=a.unit||"",h=t.values.size[s[t.KEY]],d=t.values.color[s[t.KEY]];t.model.marker.color.isDiscrete()&&d&&(d=this.model.marker.color.getColorlegendMarker().label.getItems()[d]||""),t.yTitleEl.select("text").text(t.translator("buttons/size")+": "+o(h)+" "+l),t.cTitleEl.select("text").text(t.translator("buttons/color")+": "+(d||0===d?n(d)+" "+r:t.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=this.model.marker.opacityRegular,i=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(a){return t.someHighlighted&&t.model.marker.isHighlighted(a)?1:t.someSelected?t.model.marker.isSelected(a)?1:i:t.someHighlighted?.3:e}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var a=t.model.marker.opacitySelectDim<.01;a!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&a&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,a=function(a){return a=a||"",t.model.marker.getKeys().map(function(o){var n={};return n[e]=o[e],n[i]=s,n.sortValue=t.values.size[o[e]]||0,n[e]=a+o[e],n}).sort(function(t,e){return e.sortValue-t.sortValue})},s=this.model.time.end;this.model.marker.setVisible(a.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(t){return t[e]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){o.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){o.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){o.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles)},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(a){t.size[a[i]]||0===t.size[a[i]]||e.model.marker.selectMarker(a)})},redrawDataPoints:function(t,e){var i=this;if(t||(t=this.duration),e||(e=!0),!this.entityBubbles)return o.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!");this.entityBubbles.each(function(a,s){var n=d3.select(this),l=d3.select("#"+a[i.KEY]),r=i.values.hook_lng[a[i.KEY]],h=i.values.hook_lat[a[i.KEY]],d=i.values.size[a[i.KEY]],c=i.values.color[a[i.KEY]],m=i.values.label[a[i.KEY]];a.hidden_1=a.hidden,a.hidden=!d&&0!==d||null==r||null==h,a.hidden!==a.hidden_1&&(t?n.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return n.classed("vzb-hidden",a.hidden).style("opacity",i.model.marker.opacityRegular)}):n.classed("vzb-hidden",a.hidden)),a.hidden?i._updateLabel(a,s,0,0,d,c,m,t):(a.r=o.areaToRadius(i.sScale(d||0)),a.label=m,n.classed("vzb-hidden",!1).attr("fill",null!=c?i.cScale(c):i.COLOR_WHITEISH),i.model.ui.map.colorGeo&&l.style("fill",null!=c?i.cScale(c):"#999"),e&&(a.cLoc=i.skew(i.projection([r||0,h||0])),n.attr("cx",a.cLoc[0]).attr("cy",a.cLoc[1])),t?n.transition().duration(t).ease(d3.easeLinear).attr("r",a.r):n.interrupt().attr("r",a.r).transition(),i._updateLabel(a,s,a.cLoc[0],a.cLoc[1],d,c,a.label,t))})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");e.style("font-size",null);var i=t.node().getBBox(),a=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),s=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,a.width);Math.max(i.width,a.width)>this.width?(t.style("font-size",s+"px"),e.style("font-size",s+"px")):(t.style("font-size",null),e.style("font-size",null))},initMap:function(){var t=this;this.topology||o.warn("bubble map afterPreload: missing country shapes "+this.topology),this.projection=d3["geo"+o.capitalize(this.model.ui.map.projection)](),this.mapPath=d3.geoPath().projection(this.projection),this.mapGraph=this.element.select(".vzb-bmc-map-graph"),this.mapGraph.html(""),this.mapFeature=h.feature(this.topology,this.topology.objects[this.model.ui.map.topology.objects.geo]);var e=h.mesh(this.topology,this.topology.objects[this.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e});this.projection.scale(1).translate([0,0]),this.mapBounds=this.mapPath.bounds(this.mapFeature),this.mapFeature.features?this.mapGraph.selectAll(".land").data(this.mapFeature.features).enter().insert("path").attr("d",this.mapPath).attr("id",function(e){return e.properties[t.model.ui.map.topology.geoIdProperty].toLowerCase()}).attr("class","land"):this.mapGraph.insert("path").datum(this.mapFeature).attr("class","land"),this.mapGraph.insert("path").datum(e).attr("class","boundary")},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadiusPx:.5,maxRadiusEm:.05},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadiusPx:1,maxRadiusEm:.05},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadiusPx:1,maxRadiusEm:.05}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*o.hypotenuse(t.width,t.height));var e=this.activeProfile.margin;this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,o.warn("Bubble map chart updateSize(): vizabi container is too little or has display:none")),this.repositionElements(),this.rescaleMap()},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var a=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+a.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var s=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*s.height).attr("height",.75*s.height).attr("x",-s.width-1.2*s.height).attr("y",.65*-s.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*s.height)+")").select("text"),this.yInfoEl.select("svg").node()){var n=this.yTitleEl.node().getBBox(),l=o.transform(this.yTitleEl.node()),r=i?n.x+l.translateX-1.4*e:n.x+l.translateX+n.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+r+","+(l.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var h=this.cTitleEl.node().getBBox(),d=o.transform(this.cTitleEl.node()),c=i?h.x+d.translateX-1.4*e:h.x+d.translateX+h.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+c+","+(d.translateY-.8*e)+")")}},rescaleMap:function(){var t=this.model.ui.map.offset,e=this.activeProfile.margin,i=this.model.ui.map.scale/Math.max((this.mapBounds[1][0]-this.mapBounds[0][0])/this.width,(this.mapBounds[1][1]-this.mapBounds[0][1])/this.height),a=i*(this.mapBounds[1][0]-this.mapBounds[0][0]),s=i*(this.mapBounds[1][1]-this.mapBounds[0][1]),o=s*(1+t.top+t.bottom),n=a*(1+t.left+t.right),l=s*t.top,r=a*t.left,h=[(a-i*(this.mapBounds[1][0]+this.mapBounds[0][0]))/2,(s-i*(this.mapBounds[1][1]+this.mapBounds[0][1]))/2];this.projection.scale(i).translate(h),this.mapGraph.selectAll("path").attr("d",this.mapPath);var d=void 0,c=void 0;if(this.model.ui.map.preserveAspectRatio)d=1,c=1;else{var m=o,u=n;o=this.height*this.model.ui.map.scale,n=this.width*this.model.ui.map.scale,this.mapSvg.attr("preserveAspectRatio","none").attr("viewBox",[0,0,u,m].join(" ")),d=n/(a||1)/(1+t.left+t.right),c=o/(s||1)/(1+t.top+t.bottom)}this.mapGraph.attr("transform","translate("+r+","+l+")"),this.mapSvg.style("transform","translate3d("+(e.left+(this.width-n)/2)+"px,"+(e.top+(this.height-o)/2)+"px,0)").attr("width",n).attr("height",o);var p=this;this.skew=function(){var t=p.width,e=p.height;return function(i){return[i[0]*d+(t-n)/2+r*d,i[1]*c+(e-o)/2+l*c]}}()},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return o.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,a=o.radiusToArea(Math.max(i*t[0],e)),s=o.radiusToArea(Math.max(i*t[1],e)),n=a===s?[a,s]:d3.range(a,s,(s-a)/this.sScale.domain().length).concat(s);this.sScale.range(n)},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,o.isTouchDevice()&&(this.someHighlighted?t.hovered=this.model.marker.highlight[0]:t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles())},_updateLabel:function(t,e,i,a,s,n,l,r){var h=this;if(t[this.KEY]!=h.druging&&(null==r&&(r=h.duration),h.model.marker.isSelected(t))){var d=t.hidden!==t.hidden_1,c={};c.labelX0=i/this.width,c.labelY0=a/this.height,c.scaledS0=s?o.areaToRadius(h.sScale(s)):null,c.scaledC0=null!=n?h.cScale(n):h.COLOR_WHITEISH,this._labels.updateLabel(t,e,c,i/this.width,a/this.height,s,n,l,null,r,d)}},selectMarkers:function(){var t=this;this.KEY;this.someSelected=this.model.marker.select.length>0,o.isTouchDevice()?(t._labels.showCloseCross(null,!1),t.someHighlighted?t.model.marker.clearHighlighted():(t.updateTitleNumbers(),t.fitSizeOfTitles())):t.hovered&&!t.model.marker.isSelected(t.hovered)||t._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){var e=t.label,i=t.cLoc[0],a=t.cLoc[1],s=t.r,o=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),n=void 0,l=void 0,r=-1,h=-1,d=0,c=0;s&&(d=.71*s,c=.71*s),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(e);var m=this.tooltip.select("text").node().getBBox();i-d-m.width<0?(r=1,i+=m.width+5):i-=5,a-c-m.height<0?(h=1,a+=m.height):a-=11,n=i+d*r,l=a+c*h,this.tooltip.attr("transform","translate("+(n||o[0])+","+(l||o[1])+")"),this.tooltip.select("rect").attr("width",m.width+8).attr("height",1.2*m.height).attr("x",-m.width-4).attr("y",.85*-m.height).attr("rx",.2*m.height).attr("ry",.2*m.height)}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t=this,e=this,i=function(t,i){e.model.data.getAsset(t,function(t){e.topology=t,i()})},s=o.getProp(this,["model","ui","map","topology","path"]),n=o.getProp(this,["model","ui","map","topology","which"]),l=o.getProp(this,["model","ui","map","topology","key"]);return new Promise(function(r,h){if(s)i(s,r);else if(n){var d=t.model.entities.dim,c={language:t.model.locale.id,from:"entities",select:{key:[d],value:[n]},where:{$and:[a({},d,"$"+d)]},join:a({},"$"+d,{key:d,where:a({},d,{$in:[l||"world"]})})},m=t.model.data.load(c,a({},n,function(t){return t}));m.then(function(t){i(e.model.data.getData(t)[0][n],r)},function(t){return o.warn("Problem with Preload query: ",t,JSON.stringify(c))})}else i("assets/world-50m.json",r)})}});e.default=g},function(t,e){},function(t,e){t.exports='\x3c!-- Bubble Map Chart Component --\x3e\n<div class="vzb-bubblemap">\n    <svg class="vzb-bmc-map-background vzb-export">\n        <g class="vzb-bmc-map-graph"></g>\n    </svg>\n    <svg class="vzb-bubblemap-svg vzb-export">\n        <g class="vzb-bmc-graph">\n            <g class="vzb-bmc-year"></g>\n\n            <g class="vzb-bmc-lines"></g>\n            <g class="vzb-bmc-bubbles"></g>\n            <g class="vzb-bmc-bubble-labels"></g>\n\n\n            <g class="vzb-bmc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-c-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-y-info vzb-noexport">\n            </g>\n\n            <g class="vzb-bmc-axis-c-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n            <g class="vzb-bmc-labels"></g>\n\n            <g class="vzb-bmc-tooltip vzb-hidden">\n                <rect class="vzb-tooltip-border"></rect>\n                <text class="vzb-tooltip-text"></text>\n            </g>\n        </g>\n    </svg>\n</div>\n'},function(t,e,i){t.exports=i(0)}]);
//# sourceMappingURL=bubblemap.js.map